<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MOVIE</title>
    <link href="./output.css" rel="stylesheet" />
  </head>
  <body>
    <ul id="planets-list" class="container mx-auto"></ul>
    <script type="module" src="app.js"></script>
    <!-- SCRIPT GET DATA -->
    <script>
        const finalData = [];
        // arrow function to get data from api / I prefer write it with async and await syntax and try and catch
        const getPlanetsWithReptileResidents = () => {
            return new Promise((resolve, reject) => {
                // Fetch all planets
                fetch("https://swapi.dev/api/planets/")
                .then((response) => response.json())
                .then((planetsResponse) => {
                    const planets = planetsResponse.results;
                       // Filter planets that have appeared in at least one movie and have residents
                    const planetsWithMovieAppearances = planets.filter(planet => planet.films.length > 0 && planet.residents.length > 0);
                     // Fetch movie details for each planet
                    Promise.all(planetsWithMovieAppearances.map(planet => {
                        return Promise.all(planet.films.map(movieUrl => {
                            return fetch(movieUrl)
                                .then(response => response.json())
                                .then(movieData => movieData.title);
                        })).then(movieTitles => ({
                            planet,
                            movies: movieTitles
                        }));
                    })).then(finalData => resolve(finalData))
                    .catch(error => reject(error));
                })
                .catch((error) => reject(error))
                });
            };
        // call the function here 
        getPlanetsWithReptileResidents()
            .then((planets) => {
            console.log(planets)
            const planetsList = document.getElementById("planets-list");
            planets.forEach((item) => {
                console.log(item)
                const planetListItem = document.createElement("li");
                const planetCreated = new Date(item.planet.created);
                const formattedDate = `${planetCreated.toLocaleString("en-US", {
                    day: "2-digit",
                })} ${planetCreated.toLocaleString("en-US", {
                    month: "short",
                })} ${planetCreated.toLocaleString("en-US", {
                    year: "numeric",
                })}`;
                planetListItem.innerHTML = `
                    <div
                    class="m-2 rounded w-100 bg-[#3F4045] md:bg-[#27272A] flex flex-col md:hover:ring-2 md:hover:ring-offset-2 transition ease-in-out transition-transform md:hover:scale-[95%] p-5 md:flex-row md:p-4"
                    >
                        <div class="basis-full md:basis-3/4">
                            <div>
                            <p class="text-[#FACB56] text-start text-sm md:text-base">
                                ${item.planet.created}
                            </p>
                            <!-- DESKTOP -->
                            <div class="hidden md:flex md:flex-row md:items-center py-2">
                                <div
                                class="rounded-xl h-full md:flex items-center bg-[#3F3F45]"
                                >
                                <!-- # in here If I have time I will add a package and choose it from library or use the combination of svg,symbol, use tag -->
                                <img src="./image.png" alt="image" class="w-14 h-14 p-2.5" />
                                </div>
                                <div class="px-3 flex flex-col">
                                <span class="text-white text-bold text-xl pb-1"
                                    >${item.planet.name}</span
                                >
                                <span
                                    class="hidden md:block subpixel-antialiased text-gray-400/60 text-base text-md"
                                    >${item.movies}</span
                                >
                                <span
                                    class="block md:hidden subpixel-antialiased text-gray-400/60 text-base text-md"
                                    >${item.planet.climate}</span
                                >
                                </div>
                            </div>
                            <!-- MOBILE -->
                            <div class="flex md:hidden items-center justify-between">
                                <div class="flex mt-4 flex-row">
                                <div
                                    class="w-12 h-12 bg-gradient-to-b from-gray-600/60 to-gray-500 flex items-center justify-center rounded-full"
                                >
                                    <span class="text-xl text-white">B</span>
                                </div>
                                <div class="px-3 flex flex-col">
                                    <span class="text-white text-bold text-base pb-1"
                                    >${item.planet.name}</span
                                    >
                                    <span
                                    class="block subpixel-antialiased text-gray-400/60 text-base text-md"
                                    >${item.planet.climate}</span
                                    >
                                </div>
                                </div>
                                <div>
                                <!-- # in here If I have time I will add a package and choose it from library or use the combination of svg,symbol, use tag -->
                                <img src="./image.png" alt="image" class="w-12 h-12 p-2.5" />
                                </div>
                            </div>
                            </div>
                        </div>
                        <div class="basis-full md:basis-1/4 flex items-center">
                            <div class="w-full">
                            <p
                                class="hidden md:block text-center md:text-start text-[#FACB56] text-base"
                            >
                                ${formattedDate}
                            </p>
                            <p
                                class="hidden md:block text-center md:text-start text-bold text-md subpixel-antialiased text-gray-400/60"
                            >
                                ${item.planet.climate}
                            </p>
                            <p class="block md:hidden text-start text-white mt-4 text-lg">
                                ${item.movies}
                            </p>
                            </div>
                        </div>
                    </div>
                    `;
                    planetsList.appendChild(planetListItem);
                });
            })
            .catch((error) => {
                console.error(error);
            });
    </script>
  </body>
</html>
